import{d as z,u as D,r as v,a as $,b as s,c as h,o as d,e as o,f as b,g as j,w as a,h as E,i as u,F as M,j as T,k as y,t as x,l as H,s as k,m as I,n as J,p as V,q as K,v as O}from"./main-BMNi4XeV.js";import{P as Q}from"./PatternUtil-DSsBJKfN.js";const R={class:"m-2"},Z=z({__name:"Goods",setup(W){const w=[{pattern:Q.title,message:"2个字符以上."}],n=D(),c=v(!1),m=v(!1),l=$({title:"",price:1});function C(){O(l).then(i=>{n.goodsList.push(i),l.title=""})}function F(){n.goodsFinished||K(n.goodsPn).then(i=>{n.goodsList.push(...i.data),i.hasNext?n.goodsPn+=1:n.goodsFinished=!0})}const L=(i,e)=>i.position!=="right"?!0:k({title:"确定删除吗？"}).then(()=>{const r=n.goodsList[e]?.id;return r===void 0||I(r).then(p=>{p===!0&&n.goodsList.splice(e,1)}),!0}).catch(r=>!0);function N(i){k({title:"确定兑换吗？"}).then(()=>{J(i).then(e=>{e===!0?V({type:"success",message:"兑换提交成功."}):V("兑换失败.")})}).catch(e=>{})}return(i,e)=>{const r=s("van-icon"),p=s("van-nav-bar"),f=s("van-field"),_=s("van-button"),G=s("van-cell-group"),A=s("van-form"),B=s("van-tag"),P=s("van-cell"),U=s("van-swipe-cell"),S=s("van-list");return d(),h("div",null,[o(p,{title:"欲望库"},{right:a(()=>[o(r,{name:"gift-o",size:"24",onClick:e[0]||(e[0]=t=>c.value=!c.value)})]),_:1}),c.value?(d(),b(A,{key:0,onSubmit:C},{default:a(()=>[o(G,{inset:"",class:"border mt-2"},{default:a(()=>[o(f,{label:"欲望名","input-align":"right",rules:w,modelValue:l.title,"onUpdate:modelValue":e[1]||(e[1]=t=>l.title=t)},null,8,["modelValue"]),o(f,{label:"兑换值","input-align":"right",type:"digit",modelValue:l.price,"onUpdate:modelValue":e[2]||(e[2]=t=>l.price=t)},null,8,["modelValue"]),E("div",R,[o(_,{type:"primary",size:"small",block:"","native-type":"submit"},{default:a(()=>[...e[4]||(e[4]=[u(" 提交 ",-1)])]),_:1})])]),_:1})]),_:1})):j("",!0),o(S,{loading:m.value,"onUpdate:loading":e[3]||(e[3]=t=>m.value=t),finished:y(n).goodsFinished,"finished-text":"没有更多了",onLoad:F},{default:a(()=>[(d(!0),h(M,null,T(y(n).goodsList,(t,q)=>(d(),b(U,{key:t.id,"before-close":g=>L(g,q)},{right:a(()=>[o(_,{square:"",type:"danger",text:"删除"})]),default:a(()=>[o(P,{icon:"gift","is-link":"","title-style":"flex-basis:160px; flex-grow: 1 !important"},{title:a(()=>[u(x(t.title)+" ",1),o(B,{type:"primary",class:"px-1",onClick:H(g=>N(t.id),["stop"])},{default:a(()=>[...e[5]||(e[5]=[u("兑换",-1)])]),_:1},8,["onClick"])]),value:a(()=>[u("-"+x(t.price),1),o(r,{name:"cash-o"})]),_:2},1024)]),_:2},1032,["before-close"]))),128))]),_:1},8,["loading","finished"])])}}});export{Z as default};
