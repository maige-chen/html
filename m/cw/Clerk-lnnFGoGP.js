import{y as T,d as B,u as F,r as y,o as R,b as i,c as b,e as p,f as u,g as c,q as x,z as M,A as j,F as U,p as E,j as h,x as w,t as N,i as I,l as V}from"./main-CXNK52Lh.js";const q=d=>{const n=`/m/clerk/${d}`;return T.delete(n)},z=(d,n)=>{const a=`/m/cw/clerk/${d}`;return T.put(a,n)},A=d=>{const n="/m/cw/clerk?pn="+d;return T.get(n)},D=()=>T.get("/m/cw/storeTeam"),S={del:q,update:z,list:A,getTeamGroupByStore:D},G=["value"],O={class:"m-2"},P=B({__name:"ClerkForm",emits:["success"],setup(d,{emit:n}){const a=F(),$=n,o=a.clerkList[a.clerkIdx],f=y(""),k=y([]);function r(l){if(Object.keys(a.storeTeam).length!==0){const t=a.storeTeam[l]||[];k.value=t;return}S.getTeamGroupByStore().then(t=>{a.storeTeam=t,k.value=t[l]||[]})}const e=y(o?.ratio||0),g=l=>Number(l)>0;function C(){if(o==null){w("请选择要操作的员工");return}const l={id:o.id,teamId:f.value,ratio:e.value};S.update(o.id,l).then(t=>{if(t===null){w("修改失败.");return}if(o){o.teamId=l.teamId,o.ratio=Number(l.ratio);const m=document.getElementById("team-select"),_=m.options[m.selectedIndex];_&&(o.teamTitle=_.innerHTML)}w({type:"success",message:"操作成功"}),$("success")})}return R(()=>{f.value=o?.teamId||"",e.value=o?.ratio||0,r(o?.storeId||"")}),(l,t)=>{const m=i("van-field"),_=i("van-button"),s=i("van-cell-group"),L=i("van-form");return p(),b("div",null,[u(L,{onSubmit:C},{default:c(()=>[u(s,{inset:"",class:"border mt-2"},{default:c(()=>[u(m,{label:"洗车分队"},{input:c(()=>[M(x("select",{"onUpdate:modelValue":t[0]||(t[0]=v=>f.value=v),id:"team-select",class:"form-select form-select-sm"},[t[2]||(t[2]=x("option",{value:"0"},"请选择洗车分队",-1)),(p(!0),b(U,null,E(k.value,v=>(p(),b("option",{value:v.id},N(v.title),9,G))),256))],512),[[j,f.value]])]),_:1}),u(m,{modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=v=>e.value=v),required:"",label:"洗车提成:","input-align":"right",type:"digit",placeholder:"请输入洗车提供比例",rules:[{validator:g,message:"提成必须大于0"}]},{"right-icon":c(()=>[...t[3]||(t[3]=[h(" % ",-1)])]),_:1},8,["modelValue","rules"]),x("div",O,[u(_,{type:"primary",size:"small",block:"","native-type":"submit"},{default:c(()=>[...t[4]||(t[4]=[h(" 提交 ",-1)])]),_:1})])]),_:1})]),_:1})])}}}),J=B({__name:"Clerk",setup(d){const n=F(),a=y(!1);function $(){n.clerkFinished||S.list(n.clerkPn).then(r=>{n.clerkList.push(...r.data),r.hasNext?n.clerkPn+=1:n.clerkFinished=!0})}const o=y(!1);function f(r){n.clerkIdx=r,o.value=!0}function k(r,e){const g=typeof e!="number"||isNaN(e)?"0.00%":e.toFixed(2)+"%";return`${r}: ${g}`}return(r,e)=>{const g=i("van-nav-bar"),C=i("van-tag"),l=i("van-cell"),t=i("van-list"),m=i("van-button"),_=i("van-overlay");return p(),b("div",null,[u(g,{title:"员工管理","left-arrow":"",onClickLeft:e[0]||(e[0]=s=>r.$router.replace("/"))}),u(t,{loading:a.value,"onUpdate:loading":e[1]||(e[1]=s=>a.value=s),finished:I(n).clerkFinished,"finished-text":"没有更多了",onLoad:$},{default:c(()=>[(p(!0),b(U,null,E(I(n).clerkList,(s,L)=>(p(),V(l,{key:s.id,icon:"user",value:k(s.teamTitle,s.ratio),"is-link":"",onClick:v=>f(L)},{title:c(()=>[x("span",null,N(s.nickname),1),u(C,{type:"primary",class:"ms-1"},{default:c(()=>[h(N(s.storeTitle),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["loading","finished"]),u(_,{show:o.value},{default:c(()=>[u(m,{icon:"cross",class:"border-0 bg-transparent text-light float-end",onClick:e[2]||(e[2]=s=>o.value=!1)}),e[4]||(e[4]=x("div",{id:"placeholder",style:{height:"50px"}},null,-1)),(p(),V(P,{onSuccess:e[3]||(e[3]=s=>o.value=!1),key:I(n).clerkIdx}))]),_:1},8,["show"])])}}});export{J as default};
