import{A as H}from"./ArrayUtil-gvl8aAtV.js";import{S as U,G as A,I as J}from"./borrow-Dox9yQAn.js";import{d as D,u as P,B as F,r as y,o as j,b as s,c as S,e as _,f as n,g as a,q as x,i as v,j as z,x as b,C as K,m as Q,F as R,p as W,l as E,t as N,v as X,D as q}from"./main-CXNK52Lh.js";const Y={class:"m-2"},B=D({__name:"S4Form",setup(M){const e=P(),l=e.pickedStore,C=F("showEdit"),g=F("showAdd");function f(){U.all().then(r=>e.storeList=r)}const d=y(!1);function L(r){l.id=r.selectedValues,l.title=r.selectedOptions[0].title,d.value=!1}const p=y(e.currentGroup?e.currentGroup.title:"");function m(){if(l.id[0]===void 0){b("请选择所属门店");return}if(e.currentGroup){const r={id:e.currentGroup.id,storeId:l.id[0],title:p.value,updatedAt:""};A.update(e.currentGroup.id,r).then(t=>{t===null?b("修改失败."):e.currentGroup&&(e.currentGroup.storeId=r.storeId,e.currentGroup.title=r.title,b({type:"success",message:"修改成功"}),G())})}else{const r={storeId:l.id[0],title:p.value};A.add(r).then(t=>{e.groupList.push(t),b({type:"success",message:"添加成功"}),G()})}}function G(){p.value="",l.id=[],l.title="",C&&(C.value=!1),g&&(g.value=!1),e.currentGroup=void 0}return j(()=>{f()}),(r,t)=>{const o=s("van-field"),c=s("van-button"),h=s("van-cell-group"),k=s("van-form"),$=s("van-picker"),w=s("van-popup");return _(),S("div",null,[n(k,{onSubmit:m},{default:a(()=>[n(h,{inset:"",class:"border mt-2"},{default:a(()=>[n(o,{modelValue:v(l).title,"onUpdate:modelValue":t[0]||(t[0]=u=>v(l).title=u),"is-link":"",readonly:"",name:"picker",label:"所属门店:",placeholder:"点击选择门店",onClick:t[1]||(t[1]=u=>d.value=!0)},null,8,["modelValue"]),n(o,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=u=>p.value=u),required:"",label:"客户名称:",placeholder:"请输入4S店名称",rules:[{required:!0,message:"请填写客户名称"}]},null,8,["modelValue"]),x("div",Y,[n(c,{type:"primary",size:"small",block:"","native-type":"submit"},{default:a(()=>[...t[5]||(t[5]=[z(" 提交 ",-1)])]),_:1})])]),_:1})]),_:1}),n(w,{show:d.value,"onUpdate:show":t[4]||(t[4]=u=>d.value=u),position:"bottom"},{default:a(()=>[n($,{"model-value":v(l).id,columns:v(e).storeList,"columns-field-names":{text:"title",value:"id"},onCancel:t[3]||(t[3]=u=>d.value=!1),onConfirm:L},null,8,["model-value","columns"])]),_:1},8,["show"])])}}}),Z={key:0,id:"form-wrap"},ne=D({__name:"S4",setup(M){const e=P(),l=e.pickedStore;function C(){U.all().then(t=>e.storeList=t)}const g=K(()=>H.toIdFlat(e.storeList,"title")),f=y(!1);q("showAdd",f);const d=y(!1);function L(){e.groupFinished||A.list(e.groupPn).then(t=>{e.groupList.push(...t.data),t.hasNext?e.groupPn+=1:e.groupFinished=!0})}function p(t){X({title:"确定删除吗？"}).then(()=>{const o=e.groupList[t]?.id;o!==void 0&&A.del(o).then(c=>{c===!0&&e.groupList.splice(t,1)})}).catch(()=>{})}const m=y(!1);q("showEdit",m);function G(t){e.currentGroup=e.groupList[t],e.currentGroup&&(l.id=[e.currentGroup.storeId],l.title=g.value.get(e.currentGroup.storeId)),m.value=!0}function r(t,o,c){const h={storeId:t,roles:c,groupId:o};J.add(h).then(k=>{b({type:"success",message:"邀请码生成成功."}),e.addActive(k)})}return j(()=>{C()}),(t,o)=>{const c=s("van-icon"),h=s("van-nav-bar"),k=s("van-tag"),$=s("van-cell"),w=s("van-button"),u=s("van-swipe-cell"),O=s("van-list"),T=s("van-overlay");return _(),S("div",null,[n(h,{title:"客户管理","left-arrow":"",onClickLeft:o[1]||(o[1]=i=>t.$router.push("/"))},{right:a(()=>[n(c,{name:"friends",size:"24",onClick:o[0]||(o[0]=i=>f.value=!f.value)})]),_:1}),f.value?(_(),S("div",Z,[n(B)])):Q("",!0),n(O,{loading:d.value,"onUpdate:loading":o[2]||(o[2]=i=>d.value=i),finished:v(e).groupFinished,"finished-text":"没有更多了",onLoad:L},{default:a(()=>[(_(!0),S(R,null,W(v(e).groupList,(i,I)=>(_(),E(u,{class:"border-bottom"},{right:a(()=>[n(w,{square:"",type:"danger",text:"删除",onClick:V=>p(I),class:"h-100"},null,8,["onClick"]),n(w,{square:"",type:"primary",text:"修改",onClick:V=>G(I),class:"h-100"},null,8,["onClick"])]),default:a(()=>[n($,{icon:"friends",title:i.title,value:"左滑操作",border:!1,"title-style":"flex-basis:160px; flex-grow: 1 !important"},{title:a(()=>[x("span",null,N(i.title),1),n(k,{type:"primary",class:"ms-1",onClick:V=>r(i.storeId,i.id,"S4Supervisor")},{default:a(()=>[...o[4]||(o[4]=[z("邀主管",-1)])]),_:1},8,["onClick"])]),label:a(()=>[x("span",null,"门店: "+N(g.value.get(i.storeId)),1)]),_:2},1032,["title"])]),_:2},1024))),256))]),_:1},8,["loading","finished"]),n(T,{show:m.value},{default:a(()=>[n(w,{icon:"cross",class:"border-0 bg-transparent text-light float-end",onClick:o[3]||(o[3]=i=>m.value=!1)}),o[5]||(o[5]=x("div",{id:"placeholder",style:{height:"50px"}},null,-1)),(_(),E(B,{key:v(e).currentGroup?.id}))]),_:1},8,["show"])])}}});export{ne as default};
