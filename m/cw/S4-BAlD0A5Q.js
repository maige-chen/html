import{S as B,G as S,I as H}from"./borrow-Q9wncrEJ.js";import{d as U,u as D,B as $,r as b,o as j,b as r,c as G,e as m,f as n,i,q as x,g as f,k as z,x as w,C as J,m as K,F as Q,p as R,j as N,t as P,v as W,D as E}from"./main-Daeym9Qn.js";import{A as X}from"./ArrayUtil-gvl8aAtV.js";const Y={class:"m-2"},q=U({__name:"S4Form",setup(M){const e=D(),l=e.pickedStore,_=$("showEdit"),p=$("showAdd");function y(){e.storeFinished||B.list(e.storePn).then(s=>{e.storeList.push(...s.data),s.hasNext?e.storePn+=1:e.storeFinished=!0})}const c=b(!1);function L(s){l.id=s.selectedValues,l.title=s.selectedOptions[0].title,c.value=!1}const a=b(e.currentGroup?e.currentGroup.title:"");function F(){if(l.id[0]===void 0){w("请选择所属门店");return}if(e.currentGroup){const s={id:e.currentGroup.id,storeId:l.id[0],title:a.value,updatedAt:""};S.update(e.currentGroup.id,s).then(t=>{t===null?w("修改失败."):e.currentGroup&&(e.currentGroup.storeId=s.storeId,e.currentGroup.title=s.title,w({type:"success",message:"修改成功"}),C())})}else{const s={storeId:l.id[0],title:a.value};S.add(s).then(t=>{e.groupList.push(t),w({type:"success",message:"添加成功"}),C()})}}function C(){a.value="",l.id=[],l.title="",_&&(_.value=!1),p&&(p.value=!1),e.currentGroup=void 0}return j(()=>{y()}),(s,t)=>{const o=r("van-field"),v=r("van-button"),g=r("van-cell-group"),h=r("van-form"),A=r("van-picker"),k=r("van-popup");return m(),G("div",null,[n(h,{onSubmit:F},{default:i(()=>[n(g,{inset:"",class:"border mt-2"},{default:i(()=>[n(o,{modelValue:f(l).title,"onUpdate:modelValue":t[0]||(t[0]=d=>f(l).title=d),"is-link":"",readonly:"",name:"picker",label:"所属门店:",placeholder:"点击选择门店",onClick:t[1]||(t[1]=d=>c.value=!0)},null,8,["modelValue"]),n(o,{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=d=>a.value=d),required:"",label:"客户名称:",placeholder:"请输入4S店名称",rules:[{required:!0,message:"请填写客户名称"}]},null,8,["modelValue"]),x("div",Y,[n(v,{type:"primary",size:"small",block:"","native-type":"submit"},{default:i(()=>[...t[5]||(t[5]=[z(" 提交 ",-1)])]),_:1})])]),_:1})]),_:1}),n(k,{show:c.value,"onUpdate:show":t[4]||(t[4]=d=>c.value=d),position:"bottom"},{default:i(()=>[n(A,{"model-value":f(l).id,columns:f(e).storeList,"columns-field-names":{text:"title",value:"id"},onCancel:t[3]||(t[3]=d=>c.value=!1),onConfirm:L},null,8,["model-value","columns"])]),_:1},8,["show"])])}}}),Z={key:0,id:"form-wrap"},ne=U({__name:"S4",setup(M){const e=D(),l=e.pickedStore,_=J(()=>X.toIdFlat(e.storeList,"title")),p=b(!1);E("showAdd",p);const y=b(!1);function c(){e.groupFinished||S.list(e.groupPn).then(t=>{e.groupList.push(...t.data),t.hasNext?e.groupPn+=1:e.groupFinished=!0})}function L(t){W({title:"确定删除吗？"}).then(()=>{const o=e.groupList[t]?.id;o!==void 0&&S.del(o).then(v=>{v===!0&&e.groupList.splice(t,1)})}).catch(()=>{})}const a=b(!1);E("showEdit",a);function F(t){e.currentGroup=e.groupList[t],e.currentGroup&&(l.id=[e.currentGroup.storeId],l.title=_.value.get(e.currentGroup.storeId)),a.value=!0}function C(){e.storeFinished||B.list(e.storePn).then(t=>{e.storeList.push(...t.data),t.hasNext?e.storePn+=1:e.storeFinished=!0})}function s(t,o,v){const g={storeId:t,roles:v,groupId:o};H.add(g).then(h=>{w({type:"success",message:"邀请码生成成功."}),e.addActive(h)})}return j(()=>{C()}),(t,o)=>{const v=r("van-icon"),g=r("van-nav-bar"),h=r("van-tag"),A=r("van-cell"),k=r("van-button"),d=r("van-swipe-cell"),O=r("van-list"),T=r("van-overlay");return m(),G("div",null,[n(g,{title:"客户管理","left-arrow":"",onClickLeft:o[1]||(o[1]=u=>t.$router.push("/"))},{right:i(()=>[n(v,{name:"friends",size:"24",onClick:o[0]||(o[0]=u=>p.value=!p.value)})]),_:1}),p.value?(m(),G("div",Z,[n(q)])):K("",!0),n(O,{loading:y.value,"onUpdate:loading":o[2]||(o[2]=u=>y.value=u),finished:f(e).groupFinished,"finished-text":"没有更多了",onLoad:c},{default:i(()=>[(m(!0),G(Q,null,R(f(e).groupList,(u,I)=>(m(),N(d,{class:"border-bottom"},{right:i(()=>[n(k,{square:"",type:"danger",text:"删除",onClick:V=>L(I),class:"h-100"},null,8,["onClick"]),n(k,{square:"",type:"primary",text:"修改",onClick:V=>F(I),class:"h-100"},null,8,["onClick"])]),default:i(()=>[n(A,{title:u.title,value:"左滑操作",center:"",border:!1,"title-style":"flex-basis:160px; flex-grow: 1 !important"},{title:i(()=>[x("span",null,P(u.title),1),n(h,{type:"primary",class:"ms-1",onClick:V=>s(u.storeId,u.id,"S4Supervisor")},{default:i(()=>[...o[4]||(o[4]=[z("邀主管",-1)])]),_:1},8,["onClick"])]),label:i(()=>[x("span",null,"门店: "+P(_.value.get(u.storeId)),1)]),_:2},1032,["title"])]),_:2},1024))),256))]),_:1},8,["loading","finished"]),n(T,{show:a.value},{default:i(()=>[n(k,{icon:"cross",class:"border-0 bg-transparent text-light float-end",onClick:o[3]||(o[3]=u=>a.value=!1)}),o[5]||(o[5]=x("div",{id:"placeholder",style:{height:"50px"}},null,-1)),(m(),N(q,{key:f(e).currentGroup?.id}))]),_:1},8,["show"])])}}});export{ne as default};
