import{A as B}from"./ArrayUtil-gvl8aAtV.js";import{S as E,T as C}from"./borrow-Q9wncrEJ.js";import{d as M,u as P,r as c,o as z,b as a,c as k,e as f,f as l,i as u,q as S,k as D,g as y,x as F,m as O,F as T,p as N,j as q,t as U,v as G}from"./main-Daeym9Qn.js";const H={class:"m-2"},A=M({__name:"TeamForm",emits:["success"],setup(j,{emit:o}){const n=P(),h=o,_=c(!1);function I(r){d.value=r.selectedValues,g.value=r.selectedOptions[0].title,_.value=!1}const d=c([]),g=c(""),p=c("");function s(){if(d.value===void 0){F("请选择所属门店");return}if(n.teamIdx!==-1){const r={storeId:d.value[0]||"",title:p.value},e=n.teamList[n.teamIdx]?.id||"";C.update(e,r).then(m=>{if(m===null){F("修改失败.");return}n.teamList[n.teamIdx]=m,t()})}else{const r={storeId:d.value[0]||"",title:p.value};C.add(r).then(e=>{n.teamList.unshift(e),t()})}}function t(){F({type:"success",message:"操作成功"}),n.teamIdx=-1,h("success")}const b=c();return z(()=>{E.all().then(r=>{n.storeList=r,b.value=B.toIdFlat(r,"title");const e=n.teamIdx;if(e!==-1&&n.teamList[e]!==void 0){const m=n.teamList[e]?.storeId||"";d.value=[m],g.value=b.value.get(m+"")||"",p.value=n.teamList[e]?.title}})}),(r,e)=>{const m=a("van-field"),x=a("van-button"),L=a("van-cell-group"),$=a("van-form"),V=a("van-picker"),i=a("van-popup");return f(),k("div",null,[l($,{onSubmit:s},{default:u(()=>[l(L,{inset:"",class:"border mt-2"},{default:u(()=>[l(m,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=v=>g.value=v),required:"","is-link":"",readonly:"",name:"picker",label:"所属门店:",placeholder:"点击选择门店",rules:[{required:!0,message:"请选择所属门店"}],onClick:e[1]||(e[1]=v=>_.value=!0)},null,8,["modelValue"]),l(m,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=v=>p.value=v),required:"",label:"分队名称:",placeholder:"请输入洗车小分队名称",rules:[{required:!0,message:"请填写分队名称"}]},null,8,["modelValue"]),S("div",H,[l(x,{type:"primary",size:"small",block:"","native-type":"submit"},{default:u(()=>[...e[5]||(e[5]=[D(" 提交 ",-1)])]),_:1})])]),_:1})]),_:1}),l(i,{show:_.value,"onUpdate:show":e[4]||(e[4]=v=>_.value=v),position:"bottom"},{default:u(()=>[l(V,{"model-value":d.value,columns:y(n).storeList,"columns-field-names":{text:"title",value:"id"},onCancel:e[3]||(e[3]=v=>_.value=!1),onConfirm:I},null,8,["model-value","columns"])]),_:1},8,["show"])])}}}),J={key:0,id:"form-wrap"},W=M({__name:"Team",setup(j){const o=P(),n=c(!1),h=c(!1);function _(){o.teamFinished||C.list(o.teamPn).then(s=>{o.teamList.push(...s.data),s.hasNext?o.teamPn+=1:o.teamFinished=!0})}function I(s){G({title:"确定删除吗？"}).then(()=>{const t=o.teamList[s]?.id;t!==void 0&&C.del(t).then(b=>{b===!0&&o.teamList.splice(s,1)})}).catch(()=>{})}const d=c(!1);function g(s){o.teamIdx=s,d.value=!0}const p=c();return z(()=>{E.all().then(s=>{p.value=B.toIdFlat(s,"title")})}),(s,t)=>{const b=a("van-icon"),r=a("van-nav-bar"),e=a("van-tag"),m=a("van-cell"),x=a("van-button"),L=a("van-swipe-cell"),$=a("van-list"),V=a("van-overlay");return f(),k("div",null,[l(r,{title:"洗车分队","left-arrow":"",onClickLeft:t[1]||(t[1]=i=>s.$router.replace("/"))},{right:u(()=>[l(b,{name:"flag-o",size:"24",onClick:t[0]||(t[0]=i=>(y(o).teamIdx=-1,n.value=!n.value))})]),_:1}),n.value?(f(),k("div",J,[l(A,{onSuccess:t[2]||(t[2]=i=>n.value=!1)})])):O("",!0),l($,{loading:h.value,"onUpdate:loading":t[3]||(t[3]=i=>h.value=i),finished:y(o).teamFinished,"finished-text":"没有更多了",onLoad:_},{default:u(()=>[(f(!0),k(T,null,N(y(o).teamList,(i,v)=>(f(),q(L,{class:"border-bottom"},{right:u(()=>[l(x,{square:"",type:"danger",text:"删除",onClick:w=>I(v),class:"h-100"},null,8,["onClick"]),l(x,{square:"",type:"primary",text:"修改",onClick:w=>g(v),class:"h-100"},null,8,["onClick"])]),default:u(()=>[l(m,{icon:"flag-o",title:i.title,"title-style":"flex-basis:160px; flex-grow: 1 !important"},{title:u(()=>[S("span",null,U(i.title),1),l(e,{type:"primary",class:"ms-1"},{default:u(()=>[D(U(p.value?.get(i.storeId+"")),1)]),_:2},1024)]),label:u(()=>[(f(!0),k(T,null,N(i.members,w=>(f(),q(m,{icon:"user",title:w.nickname,value:w.ratio+"%",border:!1,style:{"--van-cell-vertical-padding":"0"}},null,8,["title","value"]))),256))]),_:2},1032,["title"])]),_:2},1024))),256))]),_:1},8,["loading","finished"]),l(V,{show:d.value},{default:u(()=>[l(x,{icon:"cross",class:"border-0 bg-transparent text-light float-end",onClick:t[4]||(t[4]=i=>d.value=!1)}),t[6]||(t[6]=S("div",{id:"placeholder",style:{height:"50px"}},null,-1)),(f(),q(A,{onSuccess:t[5]||(t[5]=i=>d.value=!1),key:y(o).teamIdx}))]),_:1},8,["show"])])}}});export{W as default};
