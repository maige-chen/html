import{y as b,d as U,u as B,r as k,o as E,b as s,c as g,e as v,f as u,i as c,q as C,z as j,A as q,F as I,p as R,k as h,x as L,t as F,g as S,j as V}from"./main-Daeym9Qn.js";const z=d=>{const n=`/m/clerk/${d}`;return b.delete(n)},A=(d,n)=>{const e=`/m/cw/clerk/${d}`;return b.put(e,n)},D=d=>{const n="/m/cw/clerk?pn="+d;return b.get(n)},G=()=>b.get("/m/cw/storeTeam"),N={del:z,update:A,list:D,getTeamGroupByStore:G},M=["value"],O={class:"m-2"},P=U({__name:"ClerkForm",emits:["success"],setup(d,{emit:n}){const e=B(),T=n,i=k(""),p=k([]);function $(l){if(Object.keys(e.storeTeam).length!==0){const t=e.storeTeam[l]||[];p.value=t;return}N.getTeamGroupByStore().then(t=>{e.storeTeam=t,p.value=t[l]||[]})}const f=k(e.currentClerk?.ratio||0),a=l=>Number(l)>0;function r(){if(e.currentClerk==null){L("请选择要操作的员工");return}const l={id:e.currentClerk.id,teamId:i.value,ratio:f.value};N.update(e.currentClerk.id,l).then(t=>{if(t===null){L("修改失败.");return}e.currentClerk&&(e.currentClerk.teamId=l.teamId,e.currentClerk.ratio=l.ratio,e.currentClerk.teamTitle=t.teamTitle),_()})}function _(){L({type:"success",message:"操作成功"}),e.currentClerk=void 0,T("success")}return E(()=>{i.value=e.currentClerk?.teamId||"",f.value=e.currentClerk?.ratio||0,$(e.currentClerk?.storeId||"")}),(l,t)=>{const y=s("van-field"),x=s("van-button"),w=s("van-cell-group"),o=s("van-form");return v(),g("div",null,[u(o,{onSubmit:r},{default:c(()=>[u(w,{inset:"",class:"border mt-2"},{default:c(()=>[u(y,{label:"洗车分队"},{input:c(()=>[j(C("select",{"onUpdate:modelValue":t[0]||(t[0]=m=>i.value=m),class:"form-select form-select-sm"},[t[2]||(t[2]=C("option",{value:"0"},"请选择洗车分队",-1)),(v(!0),g(I,null,R(p.value,m=>(v(),g("option",{value:m.id},F(m.title),9,M))),256))],512),[[q,i.value]])]),_:1}),u(y,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=m=>f.value=m),required:"",label:"洗车提成:","input-align":"right",type:"digit",placeholder:"请输入洗车提供比例",rules:[{validator:a,message:"提成必须大于0"}]},{"right-icon":c(()=>[...t[3]||(t[3]=[h(" % ",-1)])]),_:1},8,["modelValue","rules"]),C("div",O,[u(x,{type:"primary",size:"small",block:"","native-type":"submit"},{default:c(()=>[...t[4]||(t[4]=[h(" 提交 ",-1)])]),_:1})])]),_:1})]),_:1})])}}}),J=U({__name:"Clerk",setup(d){const n=B(),e=k(!1);function T(){n.clerkFinished||N.list(n.clerkPn).then(a=>{n.clerkList.push(...a.data),a.hasNext?n.clerkPn+=1:n.clerkFinished=!0})}const i=k(!1),p=k("");function $(a){n.currentClerk=n.clerkList[a],p.value=n.currentClerk?.id||"",i.value=!0}function f(a,r){const _=typeof r!="number"||isNaN(r)?"0.00%":r.toFixed(2)+"%";return`${a}: ${_}`}return(a,r)=>{const _=s("van-nav-bar"),l=s("van-tag"),t=s("van-cell"),y=s("van-list"),x=s("van-button"),w=s("van-overlay");return v(),g("div",null,[u(_,{title:"员工管理","left-arrow":"",onClickLeft:r[0]||(r[0]=o=>a.$router.replace("/"))}),u(y,{loading:e.value,"onUpdate:loading":r[1]||(r[1]=o=>e.value=o),finished:S(n).clerkFinished,"finished-text":"没有更多了",onLoad:T},{default:c(()=>[(v(!0),g(I,null,R(S(n).clerkList,(o,m)=>(v(),V(t,{key:o.id,icon:"user",value:f(o.teamTitle,o.ratio),"is-link":"",onClick:K=>$(m)},{title:c(()=>[C("span",null,F(o.nickname),1),u(l,{type:"primary",class:"ms-1"},{default:c(()=>[h(F(o.storeTitle),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["loading","finished"]),u(w,{show:i.value},{default:c(()=>[u(x,{icon:"cross",class:"border-0 bg-transparent text-light float-end",onClick:r[2]||(r[2]=o=>i.value=!1)}),r[4]||(r[4]=C("div",{id:"placeholder",style:{height:"50px"}},null,-1)),(v(),V(P,{onSuccess:r[3]||(r[3]=o=>i.value=!1),key:p.value}))]),_:1},8,["show"])])}}});export{J as default};
