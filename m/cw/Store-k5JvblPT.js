import{d as X,l as G,u as h,r as c,b as s,c as L,e as v,f as l,j as V,m as H,i as a,g,k as p,F as J,p as K,q as x,t as O,v as Q,x as F}from"./main-Daeym9Qn.js";import{S as f,I as W}from"./borrow-Q9wncrEJ.js";import{c as Y}from"./Copy-OWTIET2h.js";const Z=["onClick"],le=X({__name:"Store",setup(ee){const N=G(),t=h(),u=c(!1),r=c("");function $(){r.value.length<2&&F("");const n={title:r.value};f.add(n).then(e=>{t.storeList.push(e),u.value=!1})}const S=c(!1);function B(){t.storeFinished||f.list(t.storePn).then(n=>{t.storeList.push(...n.data),n.hasNext?t.storePn+=1:t.storeFinished=!0})}function E(n){Q({title:"确定删除吗？"}).then(()=>{const e=t.storeList[n]?.id;e!==void 0&&f.del(e).then(i=>{i===!0&&t.storeList.splice(n,1)})}).catch(()=>{})}const m=c(!1);function U(n){t.currentStore=t.storeList[n],t.currentStore&&(r.value=t.currentStore.title),m.value=!0}function A(n){return n==="cancel"||t.currentStore===void 0||r.value===t.currentStore.title?!0:f.update(t.currentStore.id,r.value).then(e=>e===null?(F("修改失败"),!1):(t.currentStore!==void 0&&(t.currentStore.title=e.title),!0))}const I=h(),q=BASE_URL+"/u/#/i?c=";function k(n,e){const i={storeId:n,roles:e,groupId:""};W.add(i).then(d=>{Y(q+d.code),I.addActive(d)})}return(n,e)=>{const i=s("van-icon"),d=s("van-nav-bar"),C=s("van-button"),y=s("van-field"),P=s("van-cell-group"),R=s("van-form"),b=s("van-tag"),z=s("van-space"),D=s("van-cell"),j=s("van-swipe-cell"),M=s("van-list"),T=s("van-dialog");return v(),L("div",null,[l(d,{title:"门店管理","left-arrow":"",onClickLeft:e[1]||(e[1]=o=>g(N).replace("/"))},{right:a(()=>[l(i,{name:"shop",size:"24",onClick:e[0]||(e[0]=o=>u.value=!u.value)})]),_:1}),u.value?(v(),V(R,{key:0,onSubmit:$},{default:a(()=>[l(P,{inset:"",class:"border mt-2"},{default:a(()=>[l(y,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value=o),placeholder:"请输入门店名称",rules:[{required:!0,message:"请填写门店名称"}]},{button:a(()=>[l(C,{size:"small",type:"primary","native-type":"submit"},{default:a(()=>[...e[6]||(e[6]=[p(" 添加门店 ",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):H("",!0),l(M,{loading:S.value,"onUpdate:loading":e[3]||(e[3]=o=>S.value=o),finished:g(t).storeFinished,"finished-text":"没有更多了",onLoad:B},{default:a(()=>[(v(!0),L(J,null,K(g(t).storeList,(o,w)=>(v(),V(j,{key:o.id},{right:a(()=>[l(C,{square:"",type:"danger",text:"删除",onClick:_=>E(w)},null,8,["onClick"])]),default:a(()=>[l(D,{icon:"shop-o","title-style":"flex-basis:160px; flex-grow: 1 !important"},{title:a(()=>[x("span",null,O(o.title),1),l(z,null,{default:a(()=>[l(b,{type:"primary",class:"ms-1",onClick:_=>k(o.id,"StoreManager")},{default:a(()=>[...e[7]||(e[7]=[p(" 邀店长 ",-1)])]),_:1},8,["onClick"]),l(b,{type:"primary",onClick:_=>k(o.id,"StoreClerk")},{default:a(()=>[...e[8]||(e[8]=[p("店员",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),value:a(()=>[x("span",{onClick:_=>U(w)},[e[9]||(e[9]=p("修改",-1)),l(i,{name:"edit"})],8,Z)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading","finished"]),l(T,{show:m.value,"onUpdate:show":e[5]||(e[5]=o=>m.value=o),title:"修改标题","show-cancel-button":"","before-close":A},{default:a(()=>[l(y,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=o=>r.value=o),label:"门店:",class:"my-3 grow-value",style:{"--van-field-label-width":"3em"}},null,8,["modelValue"])]),_:1},8,["show"])])}}});export{le as default};
